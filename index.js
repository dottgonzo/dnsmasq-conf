var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var exec = require('promised-exec');
var outputFileSync = function (file, content) {
    fs.writeFileSync(file, content);
};
;
config = {
    path: '/etc/dnsmasq.conf',
    interface: false,
    test: false,
    dhcp: {
        stop: 10,
        start: 3,
        lease: '3h'
    },
    mode: false,
    dns: ['8.8.8.8', '8.8.4.4'],
    host: "192.99.0.1"
};
function parsemasq(path, config) {
    var write = '';
    if (config.noresolv) {
        write = write + 'no-resolv\n';
    }
    if (config.dhcp) {
        var root_address = config.host.split('.')[0] + '.' + config.host.split('.')[1] + '.' + config.host.split('.')[2];
        var startIp = root_address + '.' + config.dhcp.start;
        var stopIp = root_address + '.' + config.dhcp.stop;
        write = write + 'dhcp-range=' + startIp + ',' + stopIp + ',' + config.dhcp.lease + '\n';
    }
    if (config.interface) {
        write = write + 'interface=' + config.interface + '\n';
    }
    if (config.dns) {
        for (var c = 0; c < config.dns.length; c++) {
            write = write + 'server=' + config.dns[c] + '\n';
        }
    }
    if (config.address) {
        write = write + 'address=' + config.address + '\n';
    }
    outputFileSync(path, write);
    if (!config.test) {
        return exec('systemctl restart dnsmasq');
    }
    else {
        return exec('echo');
    }
}
var DMasq = (function () {
    function DNSMasq(options) {
        this.options = options;
        this.setmode = function (mode) {
            this.mode = mode;
            console.log(this.modes[mode]);
            return parsemasq(this.path, this.modes[mode]);
        };
        this.ap = function () {
            this.mode = 'ap';
            return parsemasq(this.path, this.modes.ap);
        };
        this.host = function () {
            this.mode = 'host';
            return parsemasq(this.path, this.modes.host);
        };
        this.link = function () {
            this.mode = 'link';
            return parsemasq(this.path, this.modes.link);
        };
        if (options && typeof (options) == 'object') {
            merge(config, options);
        }
        if (!pathExists.sync(config.path)) {
            throw Error('No configuration file was founded');
        }
        if (config.host.split('.').length > 4) {
            throw Error('Wrong host');
        }
        if (!config.interface) {
            throw Error('No configuration interface was provided');
        }
        for (var c = 0; c < Object.keys(config).length; c++) {
            this[Object.keys(config)[c]] = config[Object.keys(config)[c]];
        }
        this.modes = {
            ap: {
                noresolv: true,
                dns: config.dns,
                dhcp: config.dhcp,
                host: config.host,
                test: config.test,
                interface: config.interface
            },
            link: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                interface: config.interface,
                host: config.host,
                address: '/#/' + config.host
            },
            host: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                host: config.host,
                interface: config.interface,
                address: '/#/' + config.host
            }
        };
    }
    return DNSMasq;
})();
module.exports = DMasq;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInBhcnNlbWFzcSIsImNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFZLFVBQVUsV0FBTSxhQUFhLENBQUMsQ0FBQTtBQUMxQyxJQUFZLEVBQUUsV0FBTSxJQUFJLENBQUMsQ0FBQTtBQUN6QixJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNuQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDcEMsSUFBSSxjQUFjLEdBQUcsVUFBUyxJQUFXLEVBQUMsT0FBVztJQUNqRCxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBQyxPQUFPLENBQUMsQ0FBQTtBQUNsQyxDQUFDLENBQUE7QUEyQkEsQ0FBQztBQWlCRixNQUFNLEdBQUc7SUFDTCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLElBQUksRUFBRSxLQUFLO0lBQ1gsSUFBSSxFQUFFO1FBQ0YsSUFBSSxFQUFFLEVBQUU7UUFDUixLQUFLLEVBQUUsQ0FBQztRQUNSLEtBQUssRUFBRSxJQUFJO0tBQ2Q7SUFDRCxJQUFJLEVBQUUsS0FBSztJQUNYLEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDM0IsSUFBSSxFQUFFLFlBQVk7Q0FDckIsQ0FBQTtBQUlELG1CQUFtQixJQUFZLEVBQUUsTUFBWTtJQUV6Q0EsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFFZkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUFBO0lBQ2pDQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNkQSxJQUFJQSxZQUFZQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUNoSEEsSUFBSUEsT0FBT0EsR0FBR0EsWUFBWUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDckRBLElBQUlBLE1BQU1BLEdBQUdBLFlBQVlBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBRW5EQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxhQUFhQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUMzRkEsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLFlBQVlBLEdBQUdBLE1BQU1BLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUFBO0lBQzFEQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN6Q0EsS0FBS0EsR0FBR0EsS0FBS0EsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQUE7UUFDcERBLENBQUNBO0lBQ0xBLENBQUNBO0lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1FBQ2pCQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUN0REEsQ0FBQ0E7SUFHREEsY0FBY0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDNUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLDJCQUEyQkEsQ0FBQ0EsQ0FBQ0E7SUFFN0NBLENBQUNBO0lBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ0pBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBRXhCQSxDQUFDQTtBQUlMQSxDQUFDQTtBQUtELElBQUksS0FBSyxHQUFHO0lBRVIsaUJBQW1CLE9BQWdCO1FBQWhCQyxZQUFPQSxHQUFQQSxPQUFPQSxDQUFTQTtRQXVEbkNBLFlBQU9BLEdBQUdBLFVBQVNBLElBQUlBO1lBRW5CLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBRWpCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFHakQsQ0FBQyxDQUFDQTtRQUNGQSxPQUFFQSxHQUFHQTtZQUVELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRTlDLENBQUMsQ0FBQ0E7UUFDRkEsU0FBSUEsR0FBR0E7WUFFSCxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQztZQUNuQixNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUVoRCxDQUFDLENBQUNBO1FBRUZBLFNBQUlBLEdBQUdBO1lBRUgsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7WUFDbkIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFaEQsQ0FBQyxDQUFDQTtRQWhGRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLE9BQU9BLENBQUNBLENBQUFBO1FBQzFCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsbUNBQW1DQSxDQUFDQSxDQUFBQTtRQUNwREEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcENBLE1BQU1BLEtBQUtBLENBQUNBLFlBQVlBLENBQUNBLENBQUFBO1FBQzdCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsTUFBTUEsS0FBS0EsQ0FBQ0EseUNBQXlDQSxDQUFDQSxDQUFBQTtRQUMxREEsQ0FBQ0E7UUFFREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDbERBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xFQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQTtZQUNUQSxFQUFFQSxFQUFFQTtnQkFDQUEsUUFBUUEsRUFBRUEsSUFBSUE7Z0JBQ2RBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEdBQUdBO2dCQUNmQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxTQUFTQSxFQUFFQSxNQUFNQSxDQUFDQSxTQUFTQTthQUM5QkE7WUFDREEsSUFBSUEsRUFBRUE7Z0JBQ0ZBLFFBQVFBLEVBQUVBLElBQUlBO2dCQUNkQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxHQUFHQTtnQkFDZkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLFNBQVNBLEVBQUVBLE1BQU1BLENBQUNBLFNBQVNBO2dCQUMzQkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxPQUFPQSxFQUFFQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQTthQUMvQkE7WUFDREEsSUFBSUEsRUFBRUE7Z0JBQ0ZBLFFBQVFBLEVBQUVBLElBQUlBO2dCQUNkQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxHQUFHQTtnQkFDZkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsU0FBU0E7Z0JBQzNCQSxPQUFPQSxFQUFFQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQTthQUMvQkE7U0FDSkEsQ0FBQUE7SUFHTEEsQ0FBQ0E7SUFpQ0wsY0FBQztBQUFELENBdkZZLEFBdUZYLEdBQUEsQ0FBQTtBQUdELGlCQUFTLEtBQUssQ0FBQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGhFeGlzdHMgZnJvbSBcInBhdGgtZXhpc3RzXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBtZXJnZSA9IHJlcXVpcmUoXCJqc29uLWFkZFwiKTtcbmxldCBleGVjID0gcmVxdWlyZSgncHJvbWlzZWQtZXhlYycpO1xubGV0IG91dHB1dEZpbGVTeW5jID0gZnVuY3Rpb24oZmlsZTpzdHJpbmcsY29udGVudDphbnkpe1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZSxjb250ZW50KVxufVxuaW50ZXJmYWNlIENvbmZEbnNtIHtcbiAgICBwYXRoOiBzdHJpbmc7XG4gICAgaW50ZXJmYWNlOiBhbnk7XG4gICAgdGVzdDogYm9vbGVhbjtcbiAgICBkaGNwOiB7XG4gICAgICAgIHN0b3A6IG51bWJlcjtcbiAgICAgICAgc3RhcnQ6IG51bWJlcjtcbiAgICAgICAgbGVhc2U6IHN0cmluZztcbiAgICB9O1xuICAgIG1vZGU6IGJvb2xlYW47XG4gICAgZG5zOiBbc3RyaW5nXTtcbiAgICBob3N0OiBzdHJpbmc7XG59XG5pbnRlcmZhY2UgT3B0RG5zbSB7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICBpbnRlcmZhY2U6IGFueTtcbiAgICB0ZXN0PzogYm9vbGVhbjtcbiAgICBtb2RlPzogYm9vbGVhbjtcbiAgICBkbnM/OiBbc3RyaW5nXTtcbiAgICBob3N0Pzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgTW9kZXMge1xuICAgIGFwOiBNb2RlO1xuICAgIGxpbms6IE1vZGU7XG4gICAgaG9zdDogTW9kZVxufTtcblxuaW50ZXJmYWNlIE1vZGUge1xuICAgIG5vcmVzb2x2OiBib29sZWFuLFxuICAgIGRuczogW3N0cmluZ10sXG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiBudW1iZXI7XG4gICAgICAgIHN0YXJ0OiBudW1iZXI7XG4gICAgICAgIGxlYXNlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBob3N0OiBzdHJpbmcsXG4gICAgdGVzdDogYm9vbGVhbixcbiAgICBpbnRlcmZhY2U6IGFueSxcbiAgICBhZGRyZXNzPzogc3RyaW5nXG59XG5cbmRlY2xhcmUgbGV0IGNvbmZpZzogQ29uZkRuc21cbmNvbmZpZyA9IHtcbiAgICBwYXRoOiAnL2V0Yy9kbnNtYXNxLmNvbmYnLFxuICAgIGludGVyZmFjZTogZmFsc2UsXG4gICAgdGVzdDogZmFsc2UsXG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiAxMCxcbiAgICAgICAgc3RhcnQ6IDMsXG4gICAgICAgIGxlYXNlOiAnM2gnXG4gICAgfSxcbiAgICBtb2RlOiBmYWxzZSxcbiAgICBkbnM6IFsnOC44LjguOCcsICc4LjguNC40J10sXG4gICAgaG9zdDogXCIxOTIuOTkuMC4xXCJcbn1cblxuXG5cbmZ1bmN0aW9uIHBhcnNlbWFzcShwYXRoOiBzdHJpbmcsIGNvbmZpZzogTW9kZSkge1xuXG4gICAgbGV0IHdyaXRlID0gJyc7XG5cbiAgICBpZiAoY29uZmlnLm5vcmVzb2x2KSB7XG4gICAgICAgIHdyaXRlID0gd3JpdGUgKyAnbm8tcmVzb2x2XFxuJ1xuICAgIH1cblxuICAgIGlmIChjb25maWcuZGhjcCkge1xuICAgICAgICB2YXIgcm9vdF9hZGRyZXNzID0gY29uZmlnLmhvc3Quc3BsaXQoJy4nKVswXSArICcuJyArIGNvbmZpZy5ob3N0LnNwbGl0KCcuJylbMV0gKyAnLicgKyBjb25maWcuaG9zdC5zcGxpdCgnLicpWzJdXG4gICAgICAgIGxldCBzdGFydElwID0gcm9vdF9hZGRyZXNzICsgJy4nICsgY29uZmlnLmRoY3Auc3RhcnQ7XG4gICAgICAgIGxldCBzdG9wSXAgPSByb290X2FkZHJlc3MgKyAnLicgKyBjb25maWcuZGhjcC5zdG9wO1xuXG4gICAgICAgIHdyaXRlID0gd3JpdGUgKyAnZGhjcC1yYW5nZT0nICsgc3RhcnRJcCArICcsJyArIHN0b3BJcCArICcsJyArIGNvbmZpZy5kaGNwLmxlYXNlICsgJ1xcbidcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmludGVyZmFjZSkge1xuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ2ludGVyZmFjZT0nICsgY29uZmlnLmludGVyZmFjZSArICdcXG4nXG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5kbnMpIHtcbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBjb25maWcuZG5zLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ3NlcnZlcj0nICsgY29uZmlnLmRuc1tjXSArICdcXG4nXG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZy5hZGRyZXNzKSB7XG4gICAgICAgIHdyaXRlID0gd3JpdGUgKyAnYWRkcmVzcz0nICsgY29uZmlnLmFkZHJlc3MgKyAnXFxuJ1xuICAgIH1cblxuXG4gICAgb3V0cHV0RmlsZVN5bmMocGF0aCwgd3JpdGUpO1xuICAgIGlmICghY29uZmlnLnRlc3QpIHtcbiAgICAgICAgcmV0dXJuIGV4ZWMoJ3N5c3RlbWN0bCByZXN0YXJ0IGRuc21hc3EnKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBleGVjKCdlY2hvJyk7XG5cbiAgICB9XG5cblxuXG59XG5cblxuXG5cbmxldCBETWFzcSA9IGNsYXNzIEROU01hc3Ege1xuICAgIG1vZGVzOiBNb2RlcztcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgb3B0aW9uczogT3B0RG5zbSkge1xuXG4gICAgICAgIGlmIChvcHRpb25zICYmIHR5cGVvZiAob3B0aW9ucykgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG1lcmdlKGNvbmZpZywgb3B0aW9ucylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcGF0aEV4aXN0cy5zeW5jKGNvbmZpZy5wYXRoKSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIGNvbmZpZ3VyYXRpb24gZmlsZSB3YXMgZm91bmRlZCcpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLmhvc3Quc3BsaXQoJy4nKS5sZW5ndGggPiA0KSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV3JvbmcgaG9zdCcpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNvbmZpZy5pbnRlcmZhY2UpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdObyBjb25maWd1cmF0aW9uIGludGVyZmFjZSB3YXMgcHJvdmlkZWQnKVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBPYmplY3Qua2V5cyhjb25maWcpLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICB0aGlzW09iamVjdC5rZXlzKGNvbmZpZylbY11dID0gY29uZmlnW09iamVjdC5rZXlzKGNvbmZpZylbY11dO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tb2RlcyA9IHtcbiAgICAgICAgICAgIGFwOiB7XG4gICAgICAgICAgICAgICAgbm9yZXNvbHY6IHRydWUsXG4gICAgICAgICAgICAgICAgZG5zOiBjb25maWcuZG5zLFxuICAgICAgICAgICAgICAgIGRoY3A6IGNvbmZpZy5kaGNwLFxuICAgICAgICAgICAgICAgIGhvc3Q6IGNvbmZpZy5ob3N0LFxuICAgICAgICAgICAgICAgIHRlc3Q6IGNvbmZpZy50ZXN0LFxuICAgICAgICAgICAgICAgIGludGVyZmFjZTogY29uZmlnLmludGVyZmFjZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaW50ZXJmYWNlOiBjb25maWcuaW50ZXJmYWNlLFxuICAgICAgICAgICAgICAgIGhvc3Q6IGNvbmZpZy5ob3N0LFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6ICcvIy8nICsgY29uZmlnLmhvc3RcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBob3N0OiB7XG4gICAgICAgICAgICAgICAgbm9yZXNvbHY6IHRydWUsXG4gICAgICAgICAgICAgICAgZG5zOiBjb25maWcuZG5zLFxuICAgICAgICAgICAgICAgIHRlc3Q6IGNvbmZpZy50ZXN0LFxuICAgICAgICAgICAgICAgIGRoY3A6IGNvbmZpZy5kaGNwLFxuICAgICAgICAgICAgICAgIGhvc3Q6IGNvbmZpZy5ob3N0LFxuICAgICAgICAgICAgICAgIGludGVyZmFjZTogY29uZmlnLmludGVyZmFjZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiAnLyMvJyArIGNvbmZpZy5ob3N0XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG5cbiAgICBzZXRtb2RlID0gZnVuY3Rpb24obW9kZSkge1xuXG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG5cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tb2Rlc1ttb2RlXSlcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXNbbW9kZV0pXG5cblxuICAgIH07XG4gICAgYXAgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnYXAnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5hcClcblxuICAgIH07XG4gICAgaG9zdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMubW9kZSA9ICdob3N0JztcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXMuaG9zdClcblxuICAgIH07XG5cbiAgICBsaW5rID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5tb2RlID0gJ2xpbmsnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5saW5rKVxuXG4gICAgfTtcblxuXG59XG5cblxuZXhwb3J0ID0gRE1hc3E7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
