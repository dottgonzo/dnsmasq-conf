var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var exec = require('promised-exec');
var outputFileSync = function (file, content) {
    fs.writeFileSync(file, content);
};
;
config = {
    path: '/etc/dnsmasq.conf',
    interface: false,
    test: false,
    dhcp: {
        stop: 10,
        start: 3,
        lease: '3h'
    },
    dns: ['8.8.8.8', '8.8.4.4'],
    hostIp: "192.99.0.1"
};
function parsemasq(path, config) {
    var write = '';
    if (config.noresolv) {
        write = write + 'no-resolv\n';
    }
    if (config.dhcp) {
        var root_address = config.hostIp.split('.')[0] + '.' + config.hostIp.split('.')[1] + '.' + config.hostIp.split('.')[2];
        var startIp = root_address + '.' + config.dhcp.start;
        var stopIp = root_address + '.' + config.dhcp.stop;
        write = write + 'dhcp-range=' + startIp + ',' + stopIp + ',' + config.dhcp.lease + '\n';
    }
    if (config.interface) {
        write = write + 'interface=' + config.interface + '\n';
    }
    if (config.dns) {
        for (var c = 0; c < config.dns.length; c++) {
            write = write + 'server=' + config.dns[c] + '\n';
        }
    }
    if (config.address) {
        write = write + 'address=' + config.address + '\n';
    }
    outputFileSync(path, write);
    if (!config.test) {
        return exec('systemctl restart dnsmasq');
    }
    else {
        return exec('echo');
    }
}
var DMasq = (function () {
    function DNSMasq(options) {
        this.options = options;
        if (options && typeof (options) == 'object') {
            merge(config, options);
        }
        if (!pathExists.sync(config.path)) {
            throw Error('No configuration file was founded');
        }
        this.path = config.path;
        if (config.hostIp.split('.').length > 4) {
            throw Error('Wrong host');
        }
        if (!config.interface) {
            throw Error('No configuration interface was provided');
        }
        for (var c = 0; c < Object.keys(config).length; c++) {
            this[Object.keys(config)[c]] = config[Object.keys(config)[c]];
        }
        this.modes = {
            ap: {
                noresolv: true,
                dns: config.dns,
                dhcp: config.dhcp,
                hostIp: config.hostIp,
                test: config.test,
                interface: config.interface
            },
            link: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                interface: config.interface,
                hostIp: config.hostIp,
                address: '/#/' + config.hostIp
            },
            host: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                hostIp: config.hostIp,
                interface: config.interface,
                address: '/#/' + config.hostIp
            }
        };
    }
    DNSMasq.prototype.setmode = function (mode) {
        this.mode = mode;
        console.log(this.modes[mode]);
        return parsemasq(this.path, this.modes[mode]);
    };
    ;
    DNSMasq.prototype.ap = function () {
        this.mode = 'ap';
        return parsemasq(this.path, this.modes.ap);
    };
    ;
    DNSMasq.prototype.host = function () {
        this.mode = 'host';
        return parsemasq(this.path, this.modes.host);
    };
    ;
    DNSMasq.prototype.link = function () {
        this.mode = 'link';
        return parsemasq(this.path, this.modes.link);
    };
    ;
    return DNSMasq;
})();
module.exports = DMasq;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInBhcnNlbWFzcSIsImNvbnN0cnVjdG9yIiwic2V0bW9kZSIsImFwIiwiaG9zdCIsImxpbmsiXSwibWFwcGluZ3MiOiJBQUFBLElBQVksVUFBVSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQzFDLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQU8sS0FBSyxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBQ25DLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUNwQyxJQUFJLGNBQWMsR0FBRyxVQUFTLElBQVcsRUFBQyxPQUFXO0lBQ2pELEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ2xDLENBQUMsQ0FBQTtBQTJCQSxDQUFDO0FBb0JGLE1BQU0sR0FBRztJQUNMLElBQUksRUFBRSxtQkFBbUI7SUFDekIsU0FBUyxFQUFFLEtBQUs7SUFDaEIsSUFBSSxFQUFFLEtBQUs7SUFDWCxJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsRUFBRTtRQUNSLEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLElBQUk7S0FDZDtJQUNELEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDM0IsTUFBTSxFQUFFLFlBQVk7Q0FDdkIsQ0FBQTtBQUlELG1CQUFtQixJQUFZLEVBQUUsTUFBWTtJQUV6Q0EsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFFZkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUFBO0lBQ2pDQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNkQSxJQUFJQSxZQUFZQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUN0SEEsSUFBSUEsT0FBT0EsR0FBR0EsWUFBWUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDckRBLElBQUlBLE1BQU1BLEdBQUdBLFlBQVlBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBRW5EQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxhQUFhQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUMzRkEsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLFlBQVlBLEdBQUdBLE1BQU1BLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUFBO0lBQzFEQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN6Q0EsS0FBS0EsR0FBR0EsS0FBS0EsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQUE7UUFDcERBLENBQUNBO0lBQ0xBLENBQUNBO0lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1FBQ2pCQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUN0REEsQ0FBQ0E7SUFHREEsY0FBY0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDNUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLDJCQUEyQkEsQ0FBQ0EsQ0FBQ0E7SUFFN0NBLENBQUNBO0lBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ0pBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBRXhCQSxDQUFDQTtBQUlMQSxDQUFDQTtBQUtELElBQUksS0FBSyxHQUFHO0lBa0JSLGlCQUFtQixPQUFnQjtRQUFoQkMsWUFBT0EsR0FBUEEsT0FBT0EsQ0FBU0E7UUFFL0JBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE9BQU9BLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1lBQzFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFBQTtRQUMxQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLE1BQU1BLEtBQUtBLENBQUNBLG1DQUFtQ0EsQ0FBQ0EsQ0FBQUE7UUFDcERBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLElBQUlBLEdBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBRXRCQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsTUFBTUEsS0FBS0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQUE7UUFDN0JBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BCQSxNQUFNQSxLQUFLQSxDQUFDQSx5Q0FBeUNBLENBQUNBLENBQUFBO1FBQzFEQSxDQUFDQTtRQUVEQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNsREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEVBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBO1lBQ1RBLEVBQUVBLEVBQUVBO2dCQUNBQSxRQUFRQSxFQUFFQSxJQUFJQTtnQkFDZEEsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsR0FBR0E7Z0JBQ2ZBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsTUFBTUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUE7Z0JBQ3JCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLFNBQVNBLEVBQUVBLE1BQU1BLENBQUNBLFNBQVNBO2FBQzlCQTtZQUNEQSxJQUFJQSxFQUFFQTtnQkFDRkEsUUFBUUEsRUFBRUEsSUFBSUE7Z0JBQ2RBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEdBQUdBO2dCQUNmQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsU0FBU0E7Z0JBQzNCQSxNQUFNQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQTtnQkFDckJBLE9BQU9BLEVBQUVBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BO2FBQ2pDQTtZQUNEQSxJQUFJQSxFQUFFQTtnQkFDRkEsUUFBUUEsRUFBRUEsSUFBSUE7Z0JBQ2RBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEdBQUdBO2dCQUNmQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsTUFBTUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUE7Z0JBQ3JCQSxTQUFTQSxFQUFFQSxNQUFNQSxDQUFDQSxTQUFTQTtnQkFDM0JBLE9BQU9BLEVBQUVBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BO2FBQ2pDQTtTQUNKQSxDQUFBQTtJQUdMQSxDQUFDQTtJQUdELHlCQUFPLEdBQVAsVUFBUSxJQUFXO1FBRWZDLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBRWpCQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUM3QkEsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7SUFHakRBLENBQUNBOztJQUNELG9CQUFFLEdBQUY7UUFFSUMsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDakJBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLENBQUNBLENBQUFBO0lBRTlDQSxDQUFDQTs7SUFDRCxzQkFBSSxHQUFKO1FBRUlDLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ25CQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFBQTtJQUVoREEsQ0FBQ0E7O0lBRUQsc0JBQUksR0FBSjtRQUVJQyxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUNuQkEsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQUE7SUFFaERBLENBQUNBOztJQUdMLGNBQUM7QUFBRCxDQXpHWSxBQXlHWCxHQUFBLENBQUE7QUFHRCxpQkFBUyxLQUFLLENBQUMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoRXhpc3RzIGZyb20gXCJwYXRoLWV4aXN0c1wiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgbWVyZ2UgPSByZXF1aXJlKFwianNvbi1hZGRcIik7XG5sZXQgZXhlYyA9IHJlcXVpcmUoJ3Byb21pc2VkLWV4ZWMnKTtcbmxldCBvdXRwdXRGaWxlU3luYyA9IGZ1bmN0aW9uKGZpbGU6c3RyaW5nLGNvbnRlbnQ6YW55KXtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGUsY29udGVudClcbn1cbmludGVyZmFjZSBDb25mRG5zbSB7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIGludGVyZmFjZTogYW55O1xuICAgIHRlc3Q6IGJvb2xlYW47XG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiBudW1iZXI7XG4gICAgICAgIHN0YXJ0OiBudW1iZXI7XG4gICAgICAgIGxlYXNlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBtb2RlPzogc3RyaW5nO1xuICAgIGRuczogW3N0cmluZ107XG4gICAgaG9zdElwOiBzdHJpbmc7XG59XG5pbnRlcmZhY2UgT3B0RG5zbSB7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICBpbnRlcmZhY2U6IGFueTtcbiAgICB0ZXN0PzogYm9vbGVhbjtcbiAgICBtb2RlPzogc3RyaW5nO1xuICAgIGRucz86IFtzdHJpbmddO1xuICAgIGhvc3RJcD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE1vZGVzIHtcbiAgICBhcDogTW9kZTtcbiAgICBsaW5rOiBNb2RlO1xuICAgIGhvc3Q6IE1vZGVcbn07XG5cbmludGVyZmFjZSBNb2RlIHtcbiAgICBub3Jlc29sdjogYm9vbGVhbixcbiAgICBkbnM6IFtzdHJpbmddLFxuICAgIGRoY3A6IHtcbiAgICAgICAgc3RvcDogbnVtYmVyO1xuICAgICAgICBzdGFydDogbnVtYmVyO1xuICAgICAgICBsZWFzZTogc3RyaW5nO1xuICAgIH07XG4gICAgaG9zdElwOiBzdHJpbmcsXG4gICAgdGVzdDogYm9vbGVhbixcbiAgICBpbnRlcmZhY2U6IGFueSxcbiAgICBhZGRyZXNzPzogc3RyaW5nXG59XG5cblxuXG5cbmRlY2xhcmUgbGV0IGNvbmZpZzogQ29uZkRuc21cbmNvbmZpZyA9IHtcbiAgICBwYXRoOiAnL2V0Yy9kbnNtYXNxLmNvbmYnLFxuICAgIGludGVyZmFjZTogZmFsc2UsXG4gICAgdGVzdDogZmFsc2UsXG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiAxMCxcbiAgICAgICAgc3RhcnQ6IDMsXG4gICAgICAgIGxlYXNlOiAnM2gnXG4gICAgfSxcbiAgICBkbnM6IFsnOC44LjguOCcsICc4LjguNC40J10sXG4gICAgaG9zdElwOiBcIjE5Mi45OS4wLjFcIlxufVxuXG5cblxuZnVuY3Rpb24gcGFyc2VtYXNxKHBhdGg6IHN0cmluZywgY29uZmlnOiBNb2RlKSB7XG5cbiAgICBsZXQgd3JpdGUgPSAnJztcblxuICAgIGlmIChjb25maWcubm9yZXNvbHYpIHtcbiAgICAgICAgd3JpdGUgPSB3cml0ZSArICduby1yZXNvbHZcXG4nXG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5kaGNwKSB7XG4gICAgICAgIHZhciByb290X2FkZHJlc3MgPSBjb25maWcuaG9zdElwLnNwbGl0KCcuJylbMF0gKyAnLicgKyBjb25maWcuaG9zdElwLnNwbGl0KCcuJylbMV0gKyAnLicgKyBjb25maWcuaG9zdElwLnNwbGl0KCcuJylbMl1cbiAgICAgICAgbGV0IHN0YXJ0SXAgPSByb290X2FkZHJlc3MgKyAnLicgKyBjb25maWcuZGhjcC5zdGFydDtcbiAgICAgICAgbGV0IHN0b3BJcCA9IHJvb3RfYWRkcmVzcyArICcuJyArIGNvbmZpZy5kaGNwLnN0b3A7XG5cbiAgICAgICAgd3JpdGUgPSB3cml0ZSArICdkaGNwLXJhbmdlPScgKyBzdGFydElwICsgJywnICsgc3RvcElwICsgJywnICsgY29uZmlnLmRoY3AubGVhc2UgKyAnXFxuJ1xuICAgIH1cblxuICAgIGlmIChjb25maWcuaW50ZXJmYWNlKSB7XG4gICAgICAgIHdyaXRlID0gd3JpdGUgKyAnaW50ZXJmYWNlPScgKyBjb25maWcuaW50ZXJmYWNlICsgJ1xcbidcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmRucykge1xuICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGNvbmZpZy5kbnMubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgIHdyaXRlID0gd3JpdGUgKyAnc2VydmVyPScgKyBjb25maWcuZG5zW2NdICsgJ1xcbidcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY29uZmlnLmFkZHJlc3MpIHtcbiAgICAgICAgd3JpdGUgPSB3cml0ZSArICdhZGRyZXNzPScgKyBjb25maWcuYWRkcmVzcyArICdcXG4nXG4gICAgfVxuXG5cbiAgICBvdXRwdXRGaWxlU3luYyhwYXRoLCB3cml0ZSk7XG4gICAgaWYgKCFjb25maWcudGVzdCkge1xuICAgICAgICByZXR1cm4gZXhlYygnc3lzdGVtY3RsIHJlc3RhcnQgZG5zbWFzcScpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGV4ZWMoJ2VjaG8nKTtcblxuICAgIH1cblxuXG5cbn1cblxuXG5cblxubGV0IERNYXNxID0gY2xhc3MgRE5TTWFzcSBpbXBsZW1lbnRzIENvbmZEbnNtIHtcbiAgICBtb2RlczogTW9kZXM7XG4gICAgbW9kZTpzdHJpbmc7XG4gICAgcGF0aDpzdHJpbmc7XG4gICAgXG5cbiAgICBpbnRlcmZhY2U6IGFueTtcbiAgICB0ZXN0OiBib29sZWFuO1xuICAgIGRoY3A6IHtcbiAgICAgICAgc3RvcDogbnVtYmVyO1xuICAgICAgICBzdGFydDogbnVtYmVyO1xuICAgICAgICBsZWFzZTogc3RyaW5nO1xuICAgIH07XG5cbiAgICBkbnM6IFtzdHJpbmddO1xuICAgIGhvc3RJcDogc3RyaW5nO1xuICAgIFxuICAgIFxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBvcHRpb25zOiBPcHREbnNtKSB7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIChvcHRpb25zKSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgbWVyZ2UoY29uZmlnLCBvcHRpb25zKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFwYXRoRXhpc3RzLnN5bmMoY29uZmlnLnBhdGgpKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignTm8gY29uZmlndXJhdGlvbiBmaWxlIHdhcyBmb3VuZGVkJylcbiAgICAgICAgfSBcbiAgICAgICAgXG4gICAgICAgIHRoaXMucGF0aD1jb25maWcucGF0aDtcblxuICAgICAgICBpZiAoY29uZmlnLmhvc3RJcC5zcGxpdCgnLicpLmxlbmd0aCA+IDQpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXcm9uZyBob3N0JylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLmludGVyZmFjZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIGNvbmZpZ3VyYXRpb24gaW50ZXJmYWNlIHdhcyBwcm92aWRlZCcpXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IE9iamVjdC5rZXlzKGNvbmZpZykubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgIHRoaXNbT2JqZWN0LmtleXMoY29uZmlnKVtjXV0gPSBjb25maWdbT2JqZWN0LmtleXMoY29uZmlnKVtjXV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1vZGVzID0ge1xuICAgICAgICAgICAgYXA6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaG9zdElwOiBjb25maWcuaG9zdElwLFxuICAgICAgICAgICAgICAgIHRlc3Q6IGNvbmZpZy50ZXN0LFxuICAgICAgICAgICAgICAgIGludGVyZmFjZTogY29uZmlnLmludGVyZmFjZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaW50ZXJmYWNlOiBjb25maWcuaW50ZXJmYWNlLFxuICAgICAgICAgICAgICAgIGhvc3RJcDogY29uZmlnLmhvc3RJcCxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiAnLyMvJyArIGNvbmZpZy5ob3N0SXBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBob3N0OiB7XG4gICAgICAgICAgICAgICAgbm9yZXNvbHY6IHRydWUsXG4gICAgICAgICAgICAgICAgZG5zOiBjb25maWcuZG5zLFxuICAgICAgICAgICAgICAgIHRlc3Q6IGNvbmZpZy50ZXN0LFxuICAgICAgICAgICAgICAgIGRoY3A6IGNvbmZpZy5kaGNwLFxuICAgICAgICAgICAgICAgIGhvc3RJcDogY29uZmlnLmhvc3RJcCxcbiAgICAgICAgICAgICAgICBpbnRlcmZhY2U6IGNvbmZpZy5pbnRlcmZhY2UsXG4gICAgICAgICAgICAgICAgYWRkcmVzczogJy8jLycgKyBjb25maWcuaG9zdElwXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG5cbiAgICBzZXRtb2RlKG1vZGU6c3RyaW5nKSB7XG5cbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVzW21vZGVdKVxuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlc1ttb2RlXSlcblxuXG4gICAgfTtcbiAgICBhcCgpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnYXAnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5hcClcblxuICAgIH07XG4gICAgaG9zdCgpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnaG9zdCc7XG4gICAgICAgIHJldHVybiBwYXJzZW1hc3EodGhpcy5wYXRoLCB0aGlzLm1vZGVzLmhvc3QpXG5cbiAgICB9O1xuXG4gICAgbGluaygpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnbGluayc7XG4gICAgICAgIHJldHVybiBwYXJzZW1hc3EodGhpcy5wYXRoLCB0aGlzLm1vZGVzLmxpbmspXG5cbiAgICB9O1xuXG5cbn1cblxuXG5leHBvcnQgPSBETWFzcTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
