var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var exec = require('promised-exec');
var outputFileSync = function (file, content) {
    fs.writeFileSync(file, content);
};
;
config = {
    path: '/etc/dnsmasq.conf',
    interface: false,
    test: false,
    dhcp: {
        stop: 10,
        start: 3,
        lease: '3h'
    },
    dns: ['8.8.8.8', '8.8.4.4'],
    hostIp: "192.99.0.1"
};
function parsemasq(path, config) {
    var write = '';
    if (config.noresolv) {
        write = write + 'no-resolv\n';
    }
    if (config.dhcp) {
        var root_address = config.hostIp.split('.')[0] + '.' + config.hostIp.split('.')[1] + '.' + config.hostIp.split('.')[2];
        var startIp = root_address + '.' + config.dhcp.start;
        var stopIp = root_address + '.' + config.dhcp.stop;
        write = write + 'dhcp-range=' + startIp + ',' + stopIp + ',' + config.dhcp.lease + '\n';
    }
    if (config.interface) {
        write = write + 'interface=' + config.interface + '\n';
    }
    if (config.dns) {
        for (var c = 0; c < config.dns.length; c++) {
            write = write + 'server=' + config.dns[c] + '\n';
        }
    }
    if (config.address) {
        write = write + 'address=' + config.address + '\n';
    }
    outputFileSync(path, write);
    if (!config.test) {
        return exec('systemctl restart dnsmasq');
    }
    else {
        return exec('echo');
    }
}
var DMasq = (function () {
    function DNSMasq(options) {
        this.options = options;
        this.setmode = function (mode) {
            this.mode = mode;
            console.log(this.modes[mode]);
            return parsemasq(this.path, this.modes[mode]);
        };
        this.ap = function () {
            this.mode = 'ap';
            return parsemasq(this.path, this.modes.ap);
        };
        this.host = function () {
            this.mode = 'host';
            return parsemasq(this.path, this.modes.host);
        };
        this.link = function () {
            this.mode = 'link';
            return parsemasq(this.path, this.modes.link);
        };
        if (options && typeof (options) == 'object') {
            merge(config, options);
        }
        if (!pathExists.sync(config.path)) {
            throw Error('No configuration file was founded');
        }
        this.path = config.path;
        if (config.hostIp.split('.').length > 4) {
            throw Error('Wrong host');
        }
        if (!config.interface) {
            throw Error('No configuration interface was provided');
        }
        for (var c = 0; c < Object.keys(config).length; c++) {
            this[Object.keys(config)[c]] = config[Object.keys(config)[c]];
        }
        this.modes = {
            ap: {
                noresolv: true,
                dns: config.dns,
                dhcp: config.dhcp,
                hostIp: config.hostIp,
                test: config.test,
                interface: config.interface
            },
            link: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                interface: config.interface,
                hostIp: config.hostIp,
                address: '/#/' + config.hostIp
            },
            host: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                hostIp: config.hostIp,
                interface: config.interface,
                address: '/#/' + config.hostIp
            }
        };
    }
    return DNSMasq;
})();
module.exports = DMasq;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInBhcnNlbWFzcSIsImNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFZLFVBQVUsV0FBTSxhQUFhLENBQUMsQ0FBQTtBQUMxQyxJQUFZLEVBQUUsV0FBTSxJQUFJLENBQUMsQ0FBQTtBQUN6QixJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNuQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDcEMsSUFBSSxjQUFjLEdBQUcsVUFBUyxJQUFXLEVBQUMsT0FBVztJQUNqRCxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBQyxPQUFPLENBQUMsQ0FBQTtBQUNsQyxDQUFDLENBQUE7QUEyQkEsQ0FBQztBQWlCRixNQUFNLEdBQUc7SUFDTCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLElBQUksRUFBRSxLQUFLO0lBQ1gsSUFBSSxFQUFFO1FBQ0YsSUFBSSxFQUFFLEVBQUU7UUFDUixLQUFLLEVBQUUsQ0FBQztRQUNSLEtBQUssRUFBRSxJQUFJO0tBQ2Q7SUFDRCxHQUFHLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQzNCLE1BQU0sRUFBRSxZQUFZO0NBQ3ZCLENBQUE7QUFJRCxtQkFBbUIsSUFBWSxFQUFFLE1BQVk7SUFFekNBLElBQUlBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBO0lBRWZBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xCQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxhQUFhQSxDQUFBQTtJQUNqQ0EsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDZEEsSUFBSUEsWUFBWUEsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFDdEhBLElBQUlBLE9BQU9BLEdBQUdBLFlBQVlBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO1FBQ3JEQSxJQUFJQSxNQUFNQSxHQUFHQSxZQUFZQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUVuREEsS0FBS0EsR0FBR0EsS0FBS0EsR0FBR0EsYUFBYUEsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQUE7SUFDM0ZBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1FBQ25CQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxZQUFZQSxHQUFHQSxNQUFNQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUMxREEsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDekNBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLFNBQVNBLEdBQUdB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QUNBLFNBQVNBO2dCQUMzQkEsTUFBTUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUE7Z0JBQ3JCQSxPQUFPQSxFQUFFQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQTthQUNqQ0E7WUFDREEsSUFBSUEsRUFBRUE7Z0JBQ0ZBLFFBQVFBLEVBQUVBLElBQUlBO2dCQUNkQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxHQUFHQTtnQkFDZkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BO2dCQUNyQkEsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsU0FBU0E7Z0JBQzNCQSxPQUFPQSxFQUFFQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQTthQUNqQ0E7U0FDSkEsQ0FBQUE7SUFHTEEsQ0FBQ0E7SUFpQ0wsY0FBQztBQUFELENBekdZLEFBeUdYLEdBQUEsQ0FBQTtBQUdELGlCQUFTLEtBQUssQ0FBQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGhFeGlzdHMgZnJvbSBcInBhdGgtZXhpc3RzXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBtZXJnZSA9IHJlcXVpcmUoXCJqc29uLWFkZFwiKTtcbmxldCBleGVjID0gcmVxdWlyZSgncHJvbWlzZWQtZXhlYycpO1xubGV0IG91dHB1dEZpbGVTeW5jID0gZnVuY3Rpb24oZmlsZTpzdHJpbmcsY29udGVudDphbnkpe1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZSxjb250ZW50KVxufVxuaW50ZXJmYWNlIENvbmZEbnNtIHtcbiAgICBwYXRoOiBzdHJpbmc7XG4gICAgaW50ZXJmYWNlOiBhbnk7XG4gICAgdGVzdDogYm9vbGVhbjtcbiAgICBkaGNwOiB7XG4gICAgICAgIHN0b3A6IG51bWJlcjtcbiAgICAgICAgc3RhcnQ6IG51bWJlcjtcbiAgICAgICAgbGVhc2U6IHN0cmluZztcbiAgICB9O1xuICAgIG1vZGU/OiBzdHJpbmc7XG4gICAgZG5zOiBbc3RyaW5nXTtcbiAgICBob3N0SXA6IHN0cmluZztcbn1cbmludGVyZmFjZSBPcHREbnNtIHtcbiAgICBwYXRoPzogc3RyaW5nO1xuICAgIGludGVyZmFjZTogYW55O1xuICAgIHRlc3Q/OiBib29sZWFuO1xuICAgIG1vZGU/OiBzdHJpbmc7XG4gICAgZG5zPzogW3N0cmluZ107XG4gICAgaG9zdElwPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgTW9kZXMge1xuICAgIGFwOiBNb2RlO1xuICAgIGxpbms6IE1vZGU7XG4gICAgaG9zdDogTW9kZVxufTtcblxuaW50ZXJmYWNlIE1vZGUge1xuICAgIG5vcmVzb2x2OiBib29sZWFuLFxuICAgIGRuczogW3N0cmluZ10sXG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiBudW1iZXI7XG4gICAgICAgIHN0YXJ0OiBudW1iZXI7XG4gICAgICAgIGxlYXNlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBob3N0SXA6IHN0cmluZyxcbiAgICB0ZXN0OiBib29sZWFuLFxuICAgIGludGVyZmFjZTogYW55LFxuICAgIGFkZHJlc3M/OiBzdHJpbmdcbn1cblxuZGVjbGFyZSBsZXQgY29uZmlnOiBDb25mRG5zbVxuY29uZmlnID0ge1xuICAgIHBhdGg6ICcvZXRjL2Ruc21hc3EuY29uZicsXG4gICAgaW50ZXJmYWNlOiBmYWxzZSxcbiAgICB0ZXN0OiBmYWxzZSxcbiAgICBkaGNwOiB7XG4gICAgICAgIHN0b3A6IDEwLFxuICAgICAgICBzdGFydDogMyxcbiAgICAgICAgbGVhc2U6ICczaCdcbiAgICB9LFxuICAgIGRuczogWyc4LjguOC44JywgJzguOC40LjQnXSxcbiAgICBob3N0SXA6IFwiMTkyLjk5LjAuMVwiXG59XG5cblxuXG5mdW5jdGlvbiBwYXJzZW1hc3EocGF0aDogc3RyaW5nLCBjb25maWc6IE1vZGUpIHtcblxuICAgIGxldCB3cml0ZSA9ICcnO1xuXG4gICAgaWYgKGNvbmZpZy5ub3Jlc29sdikge1xuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ25vLXJlc29sdlxcbidcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmRoY3ApIHtcbiAgICAgICAgdmFyIHJvb3RfYWRkcmVzcyA9IGNvbmZpZy5ob3N0SXAuc3BsaXQoJy4nKVswXSArICcuJyArIGNvbmZpZy5ob3N0SXAuc3BsaXQoJy4nKVsxXSArICcuJyArIGNvbmZpZy5ob3N0SXAuc3BsaXQoJy4nKVsyXVxuICAgICAgICBsZXQgc3RhcnRJcCA9IHJvb3RfYWRkcmVzcyArICcuJyArIGNvbmZpZy5kaGNwLnN0YXJ0O1xuICAgICAgICBsZXQgc3RvcElwID0gcm9vdF9hZGRyZXNzICsgJy4nICsgY29uZmlnLmRoY3Auc3RvcDtcblxuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ2RoY3AtcmFuZ2U9JyArIHN0YXJ0SXAgKyAnLCcgKyBzdG9wSXAgKyAnLCcgKyBjb25maWcuZGhjcC5sZWFzZSArICdcXG4nXG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5pbnRlcmZhY2UpIHtcbiAgICAgICAgd3JpdGUgPSB3cml0ZSArICdpbnRlcmZhY2U9JyArIGNvbmZpZy5pbnRlcmZhY2UgKyAnXFxuJ1xuICAgIH1cblxuICAgIGlmIChjb25maWcuZG5zKSB7XG4gICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgY29uZmlnLmRucy5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgd3JpdGUgPSB3cml0ZSArICdzZXJ2ZXI9JyArIGNvbmZpZy5kbnNbY10gKyAnXFxuJ1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWcuYWRkcmVzcykge1xuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ2FkZHJlc3M9JyArIGNvbmZpZy5hZGRyZXNzICsgJ1xcbidcbiAgICB9XG5cblxuICAgIG91dHB1dEZpbGVTeW5jKHBhdGgsIHdyaXRlKTtcbiAgICBpZiAoIWNvbmZpZy50ZXN0KSB7XG4gICAgICAgIHJldHVybiBleGVjKCdzeXN0ZW1jdGwgcmVzdGFydCBkbnNtYXNxJyk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZXhlYygnZWNobycpO1xuXG4gICAgfVxuXG5cblxufVxuXG5cblxuXG5sZXQgRE1hc3EgPSBjbGFzcyBETlNNYXNxIGltcGxlbWVudHMgQ29uZkRuc20ge1xuICAgIG1vZGVzOiBNb2RlcztcbiAgICBtb2RlOnN0cmluZztcbiAgICBwYXRoOnN0cmluZztcbiAgICBcblxuICAgIGludGVyZmFjZTogYW55O1xuICAgIHRlc3Q6IGJvb2xlYW47XG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiBudW1iZXI7XG4gICAgICAgIHN0YXJ0OiBudW1iZXI7XG4gICAgICAgIGxlYXNlOiBzdHJpbmc7XG4gICAgfTtcblxuICAgIGRuczogW3N0cmluZ107XG4gICAgaG9zdElwOiBzdHJpbmc7XG4gICAgXG4gICAgXG4gICAgY29uc3RydWN0b3IocHVibGljIG9wdGlvbnM6IE9wdERuc20pIHtcblxuICAgICAgICBpZiAob3B0aW9ucyAmJiB0eXBlb2YgKG9wdGlvbnMpID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBtZXJnZShjb25maWcsIG9wdGlvbnMpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBhdGhFeGlzdHMuc3luYyhjb25maWcucGF0aCkpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdObyBjb25maWd1cmF0aW9uIGZpbGUgd2FzIGZvdW5kZWQnKVxuICAgICAgICB9IFxuICAgICAgICBcbiAgICAgICAgdGhpcy5wYXRoPWNvbmZpZy5wYXRoO1xuXG4gICAgICAgIGlmIChjb25maWcuaG9zdElwLnNwbGl0KCcuJykubGVuZ3RoID4gNCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dyb25nIGhvc3QnKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjb25maWcuaW50ZXJmYWNlKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignTm8gY29uZmlndXJhdGlvbiBpbnRlcmZhY2Ugd2FzIHByb3ZpZGVkJylcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgT2JqZWN0LmtleXMoY29uZmlnKS5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgdGhpc1tPYmplY3Qua2V5cyhjb25maWcpW2NdXSA9IGNvbmZpZ1tPYmplY3Qua2V5cyhjb25maWcpW2NdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubW9kZXMgPSB7XG4gICAgICAgICAgICBhcDoge1xuICAgICAgICAgICAgICAgIG5vcmVzb2x2OiB0cnVlLFxuICAgICAgICAgICAgICAgIGRuczogY29uZmlnLmRucyxcbiAgICAgICAgICAgICAgICBkaGNwOiBjb25maWcuZGhjcCxcbiAgICAgICAgICAgICAgICBob3N0SXA6IGNvbmZpZy5ob3N0SXAsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgaW50ZXJmYWNlOiBjb25maWcuaW50ZXJmYWNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazoge1xuICAgICAgICAgICAgICAgIG5vcmVzb2x2OiB0cnVlLFxuICAgICAgICAgICAgICAgIGRuczogY29uZmlnLmRucyxcbiAgICAgICAgICAgICAgICB0ZXN0OiBjb25maWcudGVzdCxcbiAgICAgICAgICAgICAgICBkaGNwOiBjb25maWcuZGhjcCxcbiAgICAgICAgICAgICAgICBpbnRlcmZhY2U6IGNvbmZpZy5pbnRlcmZhY2UsXG4gICAgICAgICAgICAgICAgaG9zdElwOiBjb25maWcuaG9zdElwLFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6ICcvIy8nICsgY29uZmlnLmhvc3RJcFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvc3Q6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaG9zdElwOiBjb25maWcuaG9zdElwLFxuICAgICAgICAgICAgICAgIGludGVyZmFjZTogY29uZmlnLmludGVyZmFjZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiAnLyMvJyArIGNvbmZpZy5ob3N0SXBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cblxuICAgIHNldG1vZGUgPSBmdW5jdGlvbihtb2RlOnN0cmluZykge1xuXG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG5cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tb2Rlc1ttb2RlXSlcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXNbbW9kZV0pXG5cblxuICAgIH07XG4gICAgYXAgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnYXAnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5hcClcblxuICAgIH07XG4gICAgaG9zdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMubW9kZSA9ICdob3N0JztcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXMuaG9zdClcblxuICAgIH07XG5cbiAgICBsaW5rID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5tb2RlID0gJ2xpbmsnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5saW5rKVxuXG4gICAgfTtcblxuXG59XG5cblxuZXhwb3J0ID0gRE1hc3E7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
