var pathExists = require("path-exists");
var fs = require("fs");
var merge = require("json-add");
var exec = require('promised-exec');
var outputFileSync = function (file, content) {
    fs.writeFileSync(file, content);
};
;
config = {
    path: '/etc/dnsmasq.conf',
    interface: false,
    test: false,
    dhcp: {
        stop: 10,
        start: 3,
        lease: '3h'
    },
    mode: false,
    dns: ['8.8.8.8', '8.8.4.4'],
    host: "192.99.0.1"
};
function parsemasq(path, config) {
    var write = '';
    if (config.noresolv) {
        write = write + 'no-resolv\n';
    }
    if (config.dhcp) {
        var root_address = config.host.split('.')[0] + '.' + config.host.split('.')[1] + '.' + config.host.split('.')[2];
        var startIp = root_address + '.' + config.dhcp.start;
        var stopIp = root_address + '.' + config.dhcp.stop;
        write = write + 'dhcp-range=' + startIp + ',' + stopIp + ',' + config.dhcp.lease + '\n';
    }
    if (config.interface) {
        write = write + 'interface=' + config.interface + '\n';
    }
    if (config.dns) {
        for (var c = 0; c < config.dns.length; c++) {
            write = write + 'server=' + config.dns[c] + '\n';
        }
    }
    if (config.address) {
        write = write + 'address=' + config.address + '\n';
    }
    outputFileSync(path, write);
    if (!config.test) {
        return exec('systemctl restart dnsmasq');
    }
    else {
        return exec('echo');
    }
}
var DMasq = (function () {
    function DNSMasq(options) {
        this.options = options;
        this.setmode = function (mode) {
            this.mode = mode;
            console.log(this.modes[mode]);
            return parsemasq(this.path, this.modes[mode]);
        };
        this.ap = function () {
            this.mode = 'ap';
            return parsemasq(this.path, this.modes.ap);
        };
        this.host = function () {
            this.mode = 'host';
            return parsemasq(this.path, this.modes.host);
        };
        this.link = function () {
            this.mode = 'link';
            return parsemasq(this.path, this.modes.link);
        };
        if (options && typeof (options) == 'object') {
            merge(config, options);
        }
        if (!pathExists.sync(config.path)) {
            throw Error('No configuration file was founded');
        }
        this.path = config.path;
        if (config.host.split('.').length > 4) {
            throw Error('Wrong host');
        }
        if (!config.interface) {
            throw Error('No configuration interface was provided');
        }
        for (var c = 0; c < Object.keys(config).length; c++) {
            this[Object.keys(config)[c]] = config[Object.keys(config)[c]];
        }
        this.modes = {
            ap: {
                noresolv: true,
                dns: config.dns,
                dhcp: config.dhcp,
                host: config.host,
                test: config.test,
                interface: config.interface
            },
            link: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                interface: config.interface,
                host: config.host,
                address: '/#/' + config.host
            },
            host: {
                noresolv: true,
                dns: config.dns,
                test: config.test,
                dhcp: config.dhcp,
                host: config.host,
                interface: config.interface,
                address: '/#/' + config.host
            }
        };
    }
    return DNSMasq;
})();
module.exports = DMasq;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInBhcnNlbWFzcSIsImNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFZLFVBQVUsV0FBTSxhQUFhLENBQUMsQ0FBQTtBQUMxQyxJQUFZLEVBQUUsV0FBTSxJQUFJLENBQUMsQ0FBQTtBQUN6QixJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNuQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDcEMsSUFBSSxjQUFjLEdBQUcsVUFBUyxJQUFXLEVBQUMsT0FBVztJQUNqRCxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBQyxPQUFPLENBQUMsQ0FBQTtBQUNsQyxDQUFDLENBQUE7QUEyQkEsQ0FBQztBQWlCRixNQUFNLEdBQUc7SUFDTCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLElBQUksRUFBRSxLQUFLO0lBQ1gsSUFBSSxFQUFFO1FBQ0YsSUFBSSxFQUFFLEVBQUU7UUFDUixLQUFLLEVBQUUsQ0FBQztRQUNSLEtBQUssRUFBRSxJQUFJO0tBQ2Q7SUFDRCxJQUFJLEVBQUUsS0FBSztJQUNYLEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDM0IsSUFBSSxFQUFFLFlBQVk7Q0FDckIsQ0FBQTtBQUlELG1CQUFtQixJQUFZLEVBQUUsTUFBWTtJQUV6Q0EsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFFZkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUFBO0lBQ2pDQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNkQSxJQUFJQSxZQUFZQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUNoSEEsSUFBSUEsT0FBT0EsR0FBR0EsWUFBWUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDckRBLElBQUlBLE1BQU1BLEdBQUdBLFlBQVlBLEdBQUdBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBRW5EQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxhQUFhQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUMzRkEsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLFlBQVlBLEdBQUdBLE1BQU1BLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUFBO0lBQzFEQSxDQUFDQTtJQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN6Q0EsS0FBS0EsR0FBR0EsS0FBS0EsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQUE7UUFDcERBLENBQUNBO0lBQ0xBLENBQUNBO0lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1FBQ2pCQSxLQUFLQSxHQUFHQSxLQUFLQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFBQTtJQUN0REEsQ0FBQ0E7SUFHREEsY0FBY0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDNUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLDJCQUEyQkEsQ0FBQ0EsQ0FBQ0E7SUFFN0NBLENBQUNBO0lBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ0pBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBRXhCQSxDQUFDQTtBQUlMQSxDQUFDQTtBQUtELElBQUksS0FBSyxHQUFHO0lBSVIsaUJBQW1CLE9BQWdCO1FBQWhCQyxZQUFPQSxHQUFQQSxPQUFPQSxDQUFTQTtRQXlEbkNBLFlBQU9BLEdBQUdBLFVBQVNBLElBQVdBO1lBRTFCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBRWpCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1lBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFHakQsQ0FBQyxDQUFDQTtRQUNGQSxPQUFFQSxHQUFHQTtZQUVELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRTlDLENBQUMsQ0FBQ0E7UUFDRkEsU0FBSUEsR0FBR0E7WUFFSCxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQztZQUNuQixNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUVoRCxDQUFDLENBQUNBO1FBRUZBLFNBQUlBLEdBQUdBO1lBRUgsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7WUFDbkIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFaEQsQ0FBQyxDQUFDQTtRQWxGRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLE9BQU9BLENBQUNBLENBQUFBO1FBQzFCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsbUNBQW1DQSxDQUFDQSxDQUFBQTtRQUNwREEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFFdEJBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BDQSxNQUFNQSxLQUFLQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFBQTtRQUM3QkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcEJBLE1BQU1BLEtBQUtBLENBQUNBLHlDQUF5Q0EsQ0FBQ0EsQ0FBQUE7UUFDMURBLENBQUNBO1FBRURBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2xEQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsRUEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0E7WUFDVEEsRUFBRUEsRUFBRUE7Z0JBQ0FBLFFBQVFBLEVBQUVBLElBQUlBO2dCQUNkQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxHQUFHQTtnQkFDZkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsU0FBU0E7YUFDOUJBO1lBQ0RBLElBQUlBLEVBQUVBO2dCQUNGQSxRQUFRQSxFQUFFQSxJQUFJQTtnQkFDZEEsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsR0FBR0E7Z0JBQ2ZBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxTQUFTQSxFQUFFQSxNQUFNQSxDQUFDQSxTQUFTQTtnQkFDM0JBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsT0FBT0EsRUFBRUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUE7YUFDL0JBO1lBQ0RBLElBQUlBLEVBQUVBO2dCQUNGQSxRQUFRQSxFQUFFQSxJQUFJQTtnQkFDZEEsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsR0FBR0E7Z0JBQ2ZBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBO2dCQUNqQkEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsSUFBSUE7Z0JBQ2pCQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxJQUFJQTtnQkFDakJBLFNBQVNBLEVBQUVBLE1BQU1BLENBQUNBLFNBQVNBO2dCQUMzQkEsT0FBT0EsRUFBRUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUE7YUFDL0JBO1NBQ0pBLENBQUFBO0lBR0xBLENBQUNBO0lBaUNMLGNBQUM7QUFBRCxDQTNGWSxBQTJGWCxHQUFBLENBQUE7QUFHRCxpQkFBUyxLQUFLLENBQUMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoRXhpc3RzIGZyb20gXCJwYXRoLWV4aXN0c1wiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgbWVyZ2UgPSByZXF1aXJlKFwianNvbi1hZGRcIik7XG5sZXQgZXhlYyA9IHJlcXVpcmUoJ3Byb21pc2VkLWV4ZWMnKTtcbmxldCBvdXRwdXRGaWxlU3luYyA9IGZ1bmN0aW9uKGZpbGU6c3RyaW5nLGNvbnRlbnQ6YW55KXtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGUsY29udGVudClcbn1cbmludGVyZmFjZSBDb25mRG5zbSB7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIGludGVyZmFjZTogYW55O1xuICAgIHRlc3Q6IGJvb2xlYW47XG4gICAgZGhjcDoge1xuICAgICAgICBzdG9wOiBudW1iZXI7XG4gICAgICAgIHN0YXJ0OiBudW1iZXI7XG4gICAgICAgIGxlYXNlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBtb2RlOiBib29sZWFuO1xuICAgIGRuczogW3N0cmluZ107XG4gICAgaG9zdDogc3RyaW5nO1xufVxuaW50ZXJmYWNlIE9wdERuc20ge1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgaW50ZXJmYWNlOiBhbnk7XG4gICAgdGVzdD86IGJvb2xlYW47XG4gICAgbW9kZT86IGJvb2xlYW47XG4gICAgZG5zPzogW3N0cmluZ107XG4gICAgaG9zdD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE1vZGVzIHtcbiAgICBhcDogTW9kZTtcbiAgICBsaW5rOiBNb2RlO1xuICAgIGhvc3Q6IE1vZGVcbn07XG5cbmludGVyZmFjZSBNb2RlIHtcbiAgICBub3Jlc29sdjogYm9vbGVhbixcbiAgICBkbnM6IFtzdHJpbmddLFxuICAgIGRoY3A6IHtcbiAgICAgICAgc3RvcDogbnVtYmVyO1xuICAgICAgICBzdGFydDogbnVtYmVyO1xuICAgICAgICBsZWFzZTogc3RyaW5nO1xuICAgIH07XG4gICAgaG9zdDogc3RyaW5nLFxuICAgIHRlc3Q6IGJvb2xlYW4sXG4gICAgaW50ZXJmYWNlOiBhbnksXG4gICAgYWRkcmVzcz86IHN0cmluZ1xufVxuXG5kZWNsYXJlIGxldCBjb25maWc6IENvbmZEbnNtXG5jb25maWcgPSB7XG4gICAgcGF0aDogJy9ldGMvZG5zbWFzcS5jb25mJyxcbiAgICBpbnRlcmZhY2U6IGZhbHNlLFxuICAgIHRlc3Q6IGZhbHNlLFxuICAgIGRoY3A6IHtcbiAgICAgICAgc3RvcDogMTAsXG4gICAgICAgIHN0YXJ0OiAzLFxuICAgICAgICBsZWFzZTogJzNoJ1xuICAgIH0sXG4gICAgbW9kZTogZmFsc2UsXG4gICAgZG5zOiBbJzguOC44LjgnLCAnOC44LjQuNCddLFxuICAgIGhvc3Q6IFwiMTkyLjk5LjAuMVwiXG59XG5cblxuXG5mdW5jdGlvbiBwYXJzZW1hc3EocGF0aDogc3RyaW5nLCBjb25maWc6IE1vZGUpIHtcblxuICAgIGxldCB3cml0ZSA9ICcnO1xuXG4gICAgaWYgKGNvbmZpZy5ub3Jlc29sdikge1xuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ25vLXJlc29sdlxcbidcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmRoY3ApIHtcbiAgICAgICAgdmFyIHJvb3RfYWRkcmVzcyA9IGNvbmZpZy5ob3N0LnNwbGl0KCcuJylbMF0gKyAnLicgKyBjb25maWcuaG9zdC5zcGxpdCgnLicpWzFdICsgJy4nICsgY29uZmlnLmhvc3Quc3BsaXQoJy4nKVsyXVxuICAgICAgICBsZXQgc3RhcnRJcCA9IHJvb3RfYWRkcmVzcyArICcuJyArIGNvbmZpZy5kaGNwLnN0YXJ0O1xuICAgICAgICBsZXQgc3RvcElwID0gcm9vdF9hZGRyZXNzICsgJy4nICsgY29uZmlnLmRoY3Auc3RvcDtcblxuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ2RoY3AtcmFuZ2U9JyArIHN0YXJ0SXAgKyAnLCcgKyBzdG9wSXAgKyAnLCcgKyBjb25maWcuZGhjcC5sZWFzZSArICdcXG4nXG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5pbnRlcmZhY2UpIHtcbiAgICAgICAgd3JpdGUgPSB3cml0ZSArICdpbnRlcmZhY2U9JyArIGNvbmZpZy5pbnRlcmZhY2UgKyAnXFxuJ1xuICAgIH1cblxuICAgIGlmIChjb25maWcuZG5zKSB7XG4gICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgY29uZmlnLmRucy5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgd3JpdGUgPSB3cml0ZSArICdzZXJ2ZXI9JyArIGNvbmZpZy5kbnNbY10gKyAnXFxuJ1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWcuYWRkcmVzcykge1xuICAgICAgICB3cml0ZSA9IHdyaXRlICsgJ2FkZHJlc3M9JyArIGNvbmZpZy5hZGRyZXNzICsgJ1xcbidcbiAgICB9XG5cblxuICAgIG91dHB1dEZpbGVTeW5jKHBhdGgsIHdyaXRlKTtcbiAgICBpZiAoIWNvbmZpZy50ZXN0KSB7XG4gICAgICAgIHJldHVybiBleGVjKCdzeXN0ZW1jdGwgcmVzdGFydCBkbnNtYXNxJyk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZXhlYygnZWNobycpO1xuXG4gICAgfVxuXG5cblxufVxuXG5cblxuXG5sZXQgRE1hc3EgPSBjbGFzcyBETlNNYXNxIHtcbiAgICBtb2RlczogTW9kZXM7XG4gICAgbW9kZTpzdHJpbmc7XG4gICAgcGF0aDpzdHJpbmc7XG4gICAgY29uc3RydWN0b3IocHVibGljIG9wdGlvbnM6IE9wdERuc20pIHtcblxuICAgICAgICBpZiAob3B0aW9ucyAmJiB0eXBlb2YgKG9wdGlvbnMpID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBtZXJnZShjb25maWcsIG9wdGlvbnMpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBhdGhFeGlzdHMuc3luYyhjb25maWcucGF0aCkpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdObyBjb25maWd1cmF0aW9uIGZpbGUgd2FzIGZvdW5kZWQnKVxuICAgICAgICB9IFxuICAgICAgICBcbiAgICAgICAgdGhpcy5wYXRoPWNvbmZpZy5wYXRoO1xuXG4gICAgICAgIGlmIChjb25maWcuaG9zdC5zcGxpdCgnLicpLmxlbmd0aCA+IDQpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXcm9uZyBob3N0JylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLmludGVyZmFjZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIGNvbmZpZ3VyYXRpb24gaW50ZXJmYWNlIHdhcyBwcm92aWRlZCcpXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IE9iamVjdC5rZXlzKGNvbmZpZykubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgIHRoaXNbT2JqZWN0LmtleXMoY29uZmlnKVtjXV0gPSBjb25maWdbT2JqZWN0LmtleXMoY29uZmlnKVtjXV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1vZGVzID0ge1xuICAgICAgICAgICAgYXA6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaG9zdDogY29uZmlnLmhvc3QsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgaW50ZXJmYWNlOiBjb25maWcuaW50ZXJmYWNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazoge1xuICAgICAgICAgICAgICAgIG5vcmVzb2x2OiB0cnVlLFxuICAgICAgICAgICAgICAgIGRuczogY29uZmlnLmRucyxcbiAgICAgICAgICAgICAgICB0ZXN0OiBjb25maWcudGVzdCxcbiAgICAgICAgICAgICAgICBkaGNwOiBjb25maWcuZGhjcCxcbiAgICAgICAgICAgICAgICBpbnRlcmZhY2U6IGNvbmZpZy5pbnRlcmZhY2UsXG4gICAgICAgICAgICAgICAgaG9zdDogY29uZmlnLmhvc3QsXG4gICAgICAgICAgICAgICAgYWRkcmVzczogJy8jLycgKyBjb25maWcuaG9zdFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvc3Q6IHtcbiAgICAgICAgICAgICAgICBub3Jlc29sdjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkbnM6IGNvbmZpZy5kbnMsXG4gICAgICAgICAgICAgICAgdGVzdDogY29uZmlnLnRlc3QsXG4gICAgICAgICAgICAgICAgZGhjcDogY29uZmlnLmRoY3AsXG4gICAgICAgICAgICAgICAgaG9zdDogY29uZmlnLmhvc3QsXG4gICAgICAgICAgICAgICAgaW50ZXJmYWNlOiBjb25maWcuaW50ZXJmYWNlLFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6ICcvIy8nICsgY29uZmlnLmhvc3RcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cblxuICAgIHNldG1vZGUgPSBmdW5jdGlvbihtb2RlOnN0cmluZykge1xuXG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG5cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tb2Rlc1ttb2RlXSlcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXNbbW9kZV0pXG5cblxuICAgIH07XG4gICAgYXAgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLm1vZGUgPSAnYXAnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5hcClcblxuICAgIH07XG4gICAgaG9zdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMubW9kZSA9ICdob3N0JztcbiAgICAgICAgcmV0dXJuIHBhcnNlbWFzcSh0aGlzLnBhdGgsIHRoaXMubW9kZXMuaG9zdClcblxuICAgIH07XG5cbiAgICBsaW5rID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5tb2RlID0gJ2xpbmsnO1xuICAgICAgICByZXR1cm4gcGFyc2VtYXNxKHRoaXMucGF0aCwgdGhpcy5tb2Rlcy5saW5rKVxuXG4gICAgfTtcblxuXG59XG5cblxuZXhwb3J0ID0gRE1hc3E7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
